#!/bin/bash
# macemu-webrtc setup script
# Creates user environment in ~/.macemu/

set -e

MACEMU_DIR="$HOME/.macemu"
CONFIG_DIR="$HOME/.config"

echo "=== macemu WebRTC Setup ===" echo ""
echo "Setting up macemu environment in $MACEMU_DIR"
echo ""

# Create directory structure
mkdir -p "$MACEMU_DIR/storage/roms"
mkdir -p "$MACEMU_DIR/storage/images"
mkdir -p "$MACEMU_DIR/client"
mkdir -p "$MACEMU_DIR/bin"
mkdir -p "$CONFIG_DIR/BasiliskII"
mkdir -p "$CONFIG_DIR/SheepShaver"

# Create symlinks to installed binaries
ln -sf /opt/macemu-webrtc/bin/BasiliskII "$MACEMU_DIR/bin/BasiliskII"
ln -sf /opt/macemu-webrtc/bin/SheepShaver "$MACEMU_DIR/bin/SheepShaver"
ln -sf /opt/macemu-webrtc/bin/macemu-webrtc-server "$MACEMU_DIR/bin/macemu-webrtc-server"

# Copy web client files
cp /opt/macemu-webrtc/client/* "$MACEMU_DIR/client/"

# Copy config template if not exists
if [ ! -f "$MACEMU_DIR/macemu-config.json" ]; then
    cp /opt/macemu-webrtc/share/macemu-config.json.template "$MACEMU_DIR/macemu-config.json"
    echo "✓ Created default config: $MACEMU_DIR/macemu-config.json"
else
    echo "✓ Config already exists: $MACEMU_DIR/macemu-config.json"
fi

echo ""
echo "=== Setup Complete! ==="
echo ""
echo "Directory structure created:"
echo "  $MACEMU_DIR/"
echo "  ├── bin/               (symlinks to emulators and server)"
echo "  ├── client/            (web UI files)"
echo "  ├── storage/"
echo "  │   ├── roms/          (place ROM files here)"
echo "  │   └── images/        (place disk images here)"
echo "  └── macemu-config.json (configuration file)"
echo ""
echo "  $CONFIG_DIR/BasiliskII/ (BasiliskII prefs and XPRAM)"
echo "  $CONFIG_DIR/SheepShaver/ (SheepShaver prefs and NVRAM)"
echo ""
echo "Next steps:"
echo "  1. Copy ROM files:   cp /path/to/roms/*.ROM $MACEMU_DIR/storage/roms/"
echo "  2. Copy disk images: cp /path/to/disks/*.dsk $MACEMU_DIR/storage/images/"
echo "  3. Edit config:      nano $MACEMU_DIR/macemu-config.json"
echo "  4. Start server:     macemu-webrtc"
echo "  5. Open browser:     http://localhost:8000"
echo ""
